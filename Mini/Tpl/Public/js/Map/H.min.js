"object" != typeof JSON && (JSON = {}), function() {
    "use strict";

    function f(e) {
        return 10 > e ? "0" + e : e
    }
    function quote(e) {
        return escapable.lastIndex = 0, escapable.test(e) ? '"' + e.replace(escapable, function(e) {
            var t = meta[e];
            return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        }) + '"' : '"' + e + '"'
    }
    function str(e, t) {
        var n, r, i, s, o, u = gap,
            a = t[e];
        switch (a && "object" == typeof a && "function" == typeof a.toJSON && (a = a.toJSON(e)), "function" == typeof rep && (a = rep.call(t, e, a)), typeof a) {
            case "string":
                return quote(a);
            case "number":
                return isFinite(a) ? String(a) : "null";
            case "boolean":
            case "null":
                return String(a);
            case "object":
                if (!a) return "null";
                if (gap += indent, o = [], "[object Array]" === Object.prototype.toString.apply(a)) {
                    for (s = a.length, n = 0; s > n; n += 1) o[n] = str(n, a) || "null";
                    return i = 0 === o.length ? "[]" : gap ? "[\n" + gap + o.join(",\n" + gap) + "\n" + u + "]" : "[" + o.join(",") + "]", gap = u, i
                }
                if (rep && "object" == typeof rep) for (s = rep.length, n = 0; s > n; n += 1)"string" == typeof rep[n] && (r = rep[n], i = str(r, a), i && o.push(quote(r) + (gap ? ": " : ":") + i));
                else for (r in a) Object.prototype.hasOwnProperty.call(a, r) && (i = str(r, a), i && o.push(quote(r) + (gap ? ": " : ":") + i));
                return i = 0 === o.length ? "{}" : gap ? "{\n" + gap + o.join(",\n" + gap) + "\n" + u + "}" : "{" + o.join(",") + "}", gap = u, i
        }
    }
    "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() {
        return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
    }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function() {
        return this.valueOf()
    });
    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap, indent, meta = {
            "\b": "\\b",
            "	": "\\t",
            "\n": "\\n",
            "\f": "\\f",
            "\r": "\\r",
            '"': '\\"',
            "\\": "\\\\"
        },
        rep;
    "function" != typeof JSON.stringify && (JSON.stringify = function(e, t, n) {
        var r;
        if (gap = "", indent = "", "number" == typeof n) for (r = 0; n > r; r += 1) indent += " ";
        else "string" == typeof n && (indent = n);
        if (rep = t, !t || "function" == typeof t || "object" == typeof t && "number" == typeof t.length) return str("", {
            "": e
        });
        throw new Error("JSON.stringify")
    }), "function" != typeof JSON.parse && (JSON.parse = function(text, reviver) {
        function walk(e, t) {
            var n, r, i = e[t];
            if (i && "object" == typeof i) for (n in i) Object.prototype.hasOwnProperty.call(i, n) && (r = walk(i, n), void 0 !== r ? i[n] = r : delete i[n]);
            return reviver.call(e, t, i)
        }
        var j;
        if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(e) {
            return "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
            "": j
        }, "") : j;
        throw new SyntaxError("JSON.parse")
    })
}();

"object" != typeof H && (H = {}), H.cityArray = ["合肥市", "芜湖市", "昌平区", "朝阳区", "崇文区", "东城区", "丰台区", "海淀区", "石景山区", "顺义区", "通州区", "西城区", "福州市", "晋江市", "莆田市", "泉州市", "厦门市", "东莞市", "佛山市", "广州市", "惠州市", "深圳市", "中山市", "珠海市", "南宁市", "贵阳市", "保定市", "廊坊市", "石家庄市", "唐山市", "洛阳市", "郑州市", "哈尔滨市", "武汉市", "宜昌市", "长沙市", "长春市", "常州市", "江阴市", "昆山市", "南京市", "南通市", "苏州市", "太仓市", "无锡市", "徐州市", "宜兴市", "镇江市", "南昌市", "大连市", "抚顺市", "沈阳市", "济南市", "济宁市", "青岛市", "威海市", "太原市", "西安市", "宝山区", "奉贤区", "虹口区", "黄浦区", "嘉定区", "金山区", "静安区", "闵行区", "浦东新区", "普陀区", "松江区", "徐汇区", "杨浦区", "闸北区", "长宁区", "成都市", "绵阳市", "天津市", "天津", "昆明市", "杭州市", "金华市", "宁波市", "绍兴市", "温州市", "余姚市", "重庆市", "北京市", "上海市", "重庆", "北京", "上海"], H.map = new BMap.Map("allmap"), H.map.addControl(new BMap.NavigationControl), H.map.enableScrollWheelZoom(), H.map.addControl(new BMap.MapTypeControl), H.infoWindow = new BMap.InfoWindow("", {
    width: 300,
    enableMessage: !1
}), H.getXHR = function() {
    var e = null;
    try {
        e = new XMLHttpRequest
    } catch (t) {
        try {
            e = new ActiveXObject("Msxml2.XMLHTTP")
        } catch (t) {
            e = new ActiveXObject("Microsoft.XMLHTTP")
        }
    }
    return e
}, H.inArray = function(e, t) {
    var n, r;
    if (t) {
        if (Array.prototype.indexOf) return Array.prototype.indexOf.call(t, e, r);
        for (n = t.length, r = 0; n > r; r++) if (r in t && t[r] === e) return r
    }
    return -1
},  H.locateByCity = function(e) {
    if (1 == e.ret) {
        var t = e.district,
            n = e.city,
            r = e.province;
        H.map.centerAndZoom(n, 11);
//        n.substring(n.length - 1) != "市" && (n += "市"), "" !== t && -1 !== H.inArray(t, H.cityArray) ? H.map.centerAndZoom(t, 14) : "" !== n && -1 !== H.inArray(n, H.cityArray) ? H.map.centerAndZoom(n, 11) : "" !== r ? H.map.centerAndZoom(r, 7) : H.map.centerAndZoom("中国", 5)
    } else H.map.centerAndZoom("中国", 5)
}, H.onMarkerClick = function() {
    H.infoWindow.setTitle(this.title);

    var e = '<table style="padding-top:8px;line-height:20px;font:12px/1.5 Tahoma,"微软雅黑",Arial,Helvetica,simsun,sans-serif;"><tr valign="top"><td style="color:#999">地址:</td><td style="color:#333">' + this.addr + '</td></tr><tr valign="top"><td style="color:#999">电话:</td><td style="color:#333">' + this.phone + '</td></tr><tr valign="top"><td style="width:75px;color:#999">销售范围:</td><td style="width:215px;color:#333">' + this.sale + '</td></tr><tr valign="top"><td style="color:#999">营业时间:</td><td style="color:#333">' + this.opentime + "</td></tr></table>";
    H.infoWindow.setContent(e), this.openInfoWindow(H.infoWindow)
    //点击地图里的店铺走这里
    $('#a_shopinfo').html(this.title);
    $('#shopInfo').hide();
    $('#a_shopinfo2').show();
    if(this.url[this.url.length-1]=='市'){
        var cnm = this.url.replace('市','');
    }
    $.weather.tipcity = cnm;
    //tips
    tipsfunction('<span id="tipshopid" data-shopid="'+this.shopid+'">'+this.title+'</span><br/>'+this.opentime);
    $.weather.init({'city' : cnm,imgpath : window.imgpath,'subid':'1','shopid':this.shopid,
        callback: function(city, temper, info){
        }
    });

}, H.initData = function(mydata) {
    var e, t, n, r = mydata.length,
        i = new BMap.Icon(tmplPath + "/js/Map/icon.png", new BMap.Size(23, 30), {
            anchor: new BMap.Size(10, 29)
        });

    for (e = 0; r > e; e++) t = new BMap.Point(parseFloat(mydata[e][2]), parseFloat(mydata[e][3])), n = new BMap.Marker(t, {
        icon: i
    }), n.title = mydata[e][0]
        , n.addr = mydata[e][1]
        , n.sale = mydata[e][4]
        , n.opentime = mydata[e][5]
        , n.phone = mydata[e][6]
        , n.url = mydata[e][7]
        , n.citycode = mydata[e][8]
        , n.shopid = mydata[e][9]
        , H.map.addOverlay(n), n.addEventListener("click", H.onMarkerClick)
}, H.init = function() {
    H.controlEvent();
},
    H.setMarkerCenter = function(marekr){
        H.infoWindow.setTitle(marekr.title);
        var e = '<table style="padding-top:8px;line-height:20px;font:12px/1.5 Tahoma,"微软雅黑",Arial,Helvetica,simsun,sans-serif;"><tr valign="top"><td style="color:#999">地址:</td><td style="color:#333">' + marekr.addr + '</td></tr><tr valign="top"><td style="color:#999">电话:</td><td style="color:#333">' + marekr.phone + '</td></tr><tr valign="top"><td style="width:75px;color:#999">销售范围:</td><td style="width:215px;color:#333">' + marekr.sale + '</td></tr><tr valign="top"><td style="color:#999">营业时间:</td><td style="color:#333">' + marekr.opentime + "</td></tr></table>";
        H.infoWindow.setContent(e);
        marekr.openInfoWindow(H.infoWindow);
        var point = H.infoWindow.getPosition();
        H.map.centerAndZoom(point,14);
    },
    H.controlEvent = function(){
        //点击显示地图
        $("#shopInfo,#a_shopinfo,#a_shopinfo2").on("click",function(){
            if($('#ddlShop option:selected').text() != '请选择'){
            //if($('#ddlShop option:selected').text()){
                var list =   H.map.getOverlays();
                for(var i=1;i<list.length;i++){
                    if(list[i].title == $('#ddlShop option:selected').text() ){
                        setTimeout(function(){
                            H.setMarkerCenter(list[i]);
                        },100);
                        break;
                    }
                }
            }
            else{
                H.map.centerAndZoom($("#nio-city").text(), 11);
            }
            $("#mapdiv").show();
        });

        $("#closemap").on("click",function(){
            $("#mapdiv").hide();
        });


        /*$("#scid").on("click",function(){
         H.map.centerAndZoom($("#scid option:selected").text(), 11);

         });*/

        $("#ddlShop").on("change",function(){
            var list =   H.map.getOverlays();
            for(var i=1;i<list.length;i++){
                if(list[i].title == $('#ddlShop option:selected').text() ){
                    H.setMarkerCenter(list[i]);
                    if(list[i].url[list[i].url.length-1]=='市'){
                        var cnm = list[i].url.replace('市','');
                    }
                    $.weather.tipcity = cnm;
                    $('#a_shopinfo').html($('#ddlShop option:selected').text());
                    $('#shopinfo').hide();
                    $('#a_shopinfo2').show();
                    //tips
                    tipsfunction($('#ddlShop option:selected').val());
                    /*var cityname = $('#scid option:selected').text();
                     if(cityname[cityname.length-1]=='市'){
                     var cnm = cityname.replace('市','');
                     }
                     $.weather.init({'city' : cnm,imgpath : window.imgpath,'subid':'1',
                     callback: function(city, temper, info){
                     var avg = getavg(temper.high,temper.low);
                     $.weather.avg = avg;
                     avg = avg?avg:0;
                     $.weather.occasion = $.weather.occasion?$.weather.occasion:0;
                     $.weather.sex = $.weather.sex?$.weather.sex:0;
                     $.weather.set = $.weather.set?$.weather.set:0;
                     var JSONP=document.createElement("script");
                     JSONP.type="text/javascript";
                     JSONP.src="http://uniqlo.bigodata.com.cn/u1_5/index.php/Index/getgood?callback=jsonpCallback4&tem="+avg+"&pro="+city+'&cid='+$.weather.occasion+'&sid='+$.weather.sex+'&tid='+$.weather.set;
                     document.getElementsByTagName("head")[0].appendChild(JSONP);
                     sendcity(city,info.city);
                     }
                     });*/
                    return;
                }
            }
        });
    }
    , window.onload = H.init